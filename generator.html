<!DOCTYPE html>
<!-- Атрибуты lang и dir будут установлены через JS -->
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Генератор Паттернов для Лото</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Rubik:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :lang(he) body { font-family: 'Rubik', sans-serif; }
        body { font-family: 'Inter', sans-serif; }
        input[type=number] { -moz-appearance: textfield; }
        input[type=number]::-webkit-inner-spin-button,
        input[type=number]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
        .focus\:ring-red-500:focus { --tw-ring-color: #ef4444; }
        .modal-overlay { transition: opacity 0.3s ease; }
        /* Для RTL смещаем кнопку "назад" вправо */
        :lang(he) .back-button {
            left: auto;
            right: 1rem;
        }
    </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-gray-100 flex items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-2xl bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6 md:p-8 relative">
        <a href="index.html" class="back-button absolute top-4 left-4 text-sm text-indigo-600 hover:text-indigo-800 dark:text-indigo-400 dark:hover:text-indigo-200 transition-colors" data-translate-key="backToHome"></a>
        <img src="logo.png" alt="Логотип" class="mx-auto h-12 w-auto mb-4 mt-8 md:mt-2">
        <h1 class="text-2xl md:text-3xl font-bold text-center text-gray-800 dark:text-white mb-2" data-translate-key="pageHeader"></h1>
        <p class="text-center text-gray-500 dark:text-gray-400 mb-6" data-translate-key="pageSubtitle"></p>
        <form id="numberForm" class="grid grid-cols-3 gap-4 mb-6"></form>
        <div class="flex justify-center mb-6">
            <button type="submit" form="numberForm" class="w-full md:w-auto bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-3 px-8 rounded-lg shadow-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 dark:focus:ring-offset-gray-800 transition-transform transform hover:scale-105" data-translate-key="generateButton"></button>
        </div>
        <div id="messageArea" class="text-center min-h-[24px]"></div>
        <div id="resultsArea" class="mt-6"></div>
    </div>

    <div id="adModal" class="modal-overlay fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-50 opacity-0 pointer-events-none">
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl p-6 text-center w-full max-w-md">
            <h3 class="text-lg font-semibold mb-2 dark:text-white" data-translate-key="modalHeader"></h3>
            <p class="mb-4 dark:text-gray-300" data-translate-key="modalText"></p>
            <div id="ad-container" class="min-w-[300px] min-h-[250px] bg-gray-200 dark:bg-gray-700 flex items-center justify-center rounded my-4">
                 <p class="text-gray-500 dark:text-gray-400" data-translate-key="adPlaceholder"></p>
            </div>
            <button id="closeAdButton" class="w-full bg-gray-200 hover:bg-gray-300 dark:bg-gray-600 dark:hover:bg-gray-500 text-gray-800 dark:text-white font-bold py-2 px-4 rounded transition-colors" data-translate-key="modalButton"></button>
        </div>
    </div>

    <script>
        const translations = {
            ru: {
                pageTitle: "Генератор Паттернов для Лото", backToHome: "← На главную", pageHeader: "Генератор комбинаций", pageSubtitle: "Введите 9 уникальных чисел от 1 до 37.", generateButton: "Сгенерировать", numberLabel: "Число", errorDuplicate: "Найдены повторяющиеся числа. Введите уникальные значения.", errorAllFields: "Пожалуйста, введите все 9 чисел.", errorInvalidNumber: "Неверный ввод. Введите числа от 1 до 37.", modalHeader: "Пожалуйста, подождите", modalText: "Ваши комбинации готовы! <br>Наш сервис работает благодаря рекламе.", adPlaceholder: "Здесь будет ваш рекламный блок", modalButton: "Показать комбинации", comboLabel: "Комбинация", resultsHeader: "Внимательно заполни карточку лото следующими номерами:"
            },
            en: {
                pageTitle: "Lotto Pattern Generator", backToHome: "← Back to Home", pageHeader: "Combination Generator", pageSubtitle: "Enter 9 unique numbers from 1 to 37.", generateButton: "Generate", numberLabel: "Number", errorDuplicate: "Duplicate numbers found. Please enter unique values.", errorAllFields: "Please enter all 9 numbers.", errorInvalidNumber: "Invalid input. Please enter numbers from 1 to 37.", modalHeader: "Please Wait", modalText: "Your combinations are ready! <br>Our service is made possible by ads.", adPlaceholder: "Your ad unit will be here", modalButton: "Show Combinations", comboLabel: "Combination", resultsHeader: "Carefully fill out your lottery ticket with the following numbers:"
            },
            he: {
                pageTitle: "מחולל תבניות ללוטו", backToHome: "לדף הבית →", pageHeader: "מחולל צירופים", pageSubtitle: "הזינו 9 מספרים ייחודיים מ-1 עד 37.", generateButton: "צור צירופים", numberLabel: "מספר", errorDuplicate: "נמצאו מספרים כפולים. אנא הזינו ערכים ייחודיים.", errorAllFields: "אנא הזינו את כל 9 המספרים.", errorInvalidNumber: "קלט לא חוקי. אנא הזינו מספרים בין 1 ל-37.", modalHeader: "אנא המתינו", modalText: "הצירופים שלכם מוכנים! <br>השירות שלנו מתאפשר בזכות פרסומות.", adPlaceholder: "כאן תוצג יחידת המודעות שלכם", modalButton: "הצג צירופים", comboLabel: "צירוף", resultsHeader: "מלאו בקפידה את כרטיס הלוטו עם המספרים הבאים:"
            }
        };

        let currentLangPack = translations.ru;
        const form = document.getElementById('numberForm');
        const resultsArea = document.getElementById('resultsArea');
        const messageArea = document.getElementById('messageArea');
        const adModal = document.getElementById('adModal');
        const closeAdButton = document.getElementById('closeAdButton');
        let numberInputs = [];
        let validatedUserNumbers = [];
        const patterns = [[1, 2, 3, 4, 5, 6], [1, 2, 3, 7, 8, 9], [1, 2, 4, 5, 7, 9], [1, 2, 4, 6, 7, 8], [1, 2, 5, 6, 8, 9], [1, 3, 4, 5, 8, 9], [1, 3, 5, 6, 7, 8], [1, 3, 4, 6, 7, 9], [2, 3, 4, 5, 7, 8], [2, 3, 5, 6, 7, 9], [2, 3, 4, 6, 8, 9], [4, 5, 6, 7, 8, 9]];

        function getUserLanguage() {
            const lang = navigator.language || navigator.userLanguage;
            return lang.split('-')[0];
        }

        function applyTranslations() {
            const lang = getUserLanguage();
            currentLangPack = translations[lang] || translations.ru;
            document.documentElement.lang = lang;
            document.documentElement.dir = lang === 'he' ? 'rtl' : 'ltr';
            document.title = currentLangPack.pageTitle;
            document.querySelectorAll('[data-translate-key]').forEach(element => {
                const key = element.getAttribute('data-translate-key');
                if (currentLangPack[key]) {
                    element.innerHTML = currentLangPack[key];
                }
            });
        }

        function createInputFields() {
            let formHTML = '';
            for (let i = 0; i < 9; i++) {
                formHTML += `<div class="relative"><label for="num${i}" class="absolute -top-2.5 left-2 rtl:left-auto rtl:right-2 inline-block bg-white dark:bg-gray-800 px-1 text-xs font-medium text-gray-500 dark:text-gray-400">${currentLangPack.numberLabel} ${i + 1}</label><input type="number" id="num${i}" name="num${i}" min="1" max="37" class="block w-full rounded-md border-0 py-2.5 px-3 text-gray-900 dark:text-white bg-transparent shadow-sm ring-1 ring-inset ring-gray-300 dark:ring-gray-600 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6" required></div>`;
            }
            form.innerHTML = formHTML;
            numberInputs = Array.from({ length: 9 }, (_, i) => document.getElementById(`num${i}`));
            numberInputs.forEach(input => input.addEventListener('input', checkForDuplicates));
        }

        function displayMessage(messageKey, type) {
            const message = currentLangPack[messageKey] || messageKey;
            const color = type === 'error' ? 'text-red-500' : 'text-green-500';
            messageArea.innerHTML = `<p class="${color} font-medium">${message}</p>`;
        }

        function generateAndDisplayResults() {
            resultsArea.innerHTML = ''; // Очищаем предыдущие результаты

            // Создаем и добавляем заголовок
            const header = document.createElement('h2');
            header.textContent = currentLangPack.resultsHeader;
            header.className = 'text-lg font-semibold text-center text-gray-800 dark:text-white mb-4';
            resultsArea.appendChild(header);
            
            // Создаем контейнер для карточек
            const cardsContainer = document.createElement('div');
            cardsContainer.className = 'space-y-3';
            resultsArea.appendChild(cardsContainer);

            patterns.forEach((pattern, index) => {
                const resultString = pattern.map(p_num => validatedUserNumbers[p_num - 1]).sort((a, b) => a - b).join(' - ');
                const resultCard = document.createElement('div');
                resultCard.className = 'bg-gray-50 dark:bg-gray-700/50 p-3 sm:p-4 rounded-lg shadow-sm flex flex-wrap items-baseline justify-between gap-x-4';
                resultCard.innerHTML = `
                    <span class="font-semibold text-gray-600 dark:text-gray-300">${currentLangPack.comboLabel} ${index + 1}:</span>
                    <span class="font-mono text-base sm:text-lg text-indigo-600 dark:text-indigo-400 tracking-wider">${resultString}</span>`;
                cardsContainer.appendChild(resultCard);
            });
        }

        function checkForDuplicates() {
            numberInputs.forEach(input => input.classList.remove('ring-red-500', 'focus:ring-red-500'));
            const values = numberInputs.map(input => input.value).filter(Boolean);
            const duplicates = values.filter((item, index) => values.indexOf(item) !== index);
            if (duplicates.length > 0) {
                displayMessage('errorDuplicate', 'error');
                numberInputs.forEach(input => {
                    if (duplicates.includes(input.value)) input.classList.add('ring-red-500', 'focus:ring-red-500');
                });
                return true;
            } else {
                if (messageArea.textContent === currentLangPack.errorDuplicate) messageArea.innerHTML = '';
                return false;
            }
        }

        form.addEventListener('submit', function(event) {
            event.preventDefault();
            resultsArea.innerHTML = '';
            if (checkForDuplicates()) return;
            const userNumbers = [];
            let hasError = false;
            for (const inputField of numberInputs) {
                const value = parseInt(inputField.value, 10);
                if (!value) {
                    displayMessage('errorAllFields', 'error');
                    hasError = true;
                    break;
                }
                if (value < 1 || value > 37) {
                    displayMessage('errorInvalidNumber', 'error');
                    inputField.classList.add('ring-red-500', 'focus:ring-red-500');
                    hasError = true;
                    break;
                }
                userNumbers.push(value);
            }
            if (userNumbers.length < 9 && !hasError) {
                displayMessage('errorAllFields', 'error');
                hasError = true;
            }
            if (!hasError) {
                messageArea.innerHTML = '';
                validatedUserNumbers = userNumbers;
                adModal.classList.remove('opacity-0', 'pointer-events-none');
            }
        });

        closeAdButton.addEventListener('click', () => {
            adModal.classList.add('opacity-0', 'pointer-events-none');
            generateAndDisplayResults();
        });

        document.addEventListener('DOMContentLoaded', () => {
            applyTranslations();
            createInputFields();
        });
    </script>
</body>
</html>

